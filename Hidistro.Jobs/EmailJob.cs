using Hidistro.Core.Jobs;
using Hidistro.Membership.Context;
using Hidistro.Messages;
using System;
using System.Globalization;
using System.Xml;
namespace Hidistro.Jobs
{
	public class EmailJob : IJob
	{
		private int failureInterval = 15;
		private int numberOfTries = 5;
		public void Execute(XmlNode node)
		{
			if (null != node)
			{
				XmlAttribute xmlAttribute = node.Attributes["failureInterval"];
				XmlAttribute xmlAttribute2 = node.Attributes["numberOfTries"];
				if (xmlAttribute != null)
				{
					try
					{
						this.failureInterval = int.Parse(xmlAttribute.Value, CultureInfo.InvariantCulture);
					}
					catch
					{
						this.failureInterval = 15;
					}
				}
				if (xmlAttribute2 != null)
				{
					try
					{
						this.numberOfTries = int.Parse(xmlAttribute2.Value, CultureInfo.InvariantCulture);
					}
					catch
					{
						this.numberOfTries = 5;
					}
				}
				this.SendQueuedEmailJob();
			}
		}
		public void SendQueuedEmailJob()
		{
			SiteSettings masterSettings = SettingsManager.GetMasterSettings(true);
			if (masterSettings != null)
			{
				Emails.SendQueuedEmails(this.failureInterval, this.numberOfTries, masterSettings);
			}
		}
	}
}
